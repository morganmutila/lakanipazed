<div class="upload_music no-flex no-min-height" id="upload-bulk-song-form-{{form_id}}">
	<div class="upload upload_block_album">
		<input class="upload-audio-file-{{form_id}} custom-file-input" type="file" {{ATTR}} multiple data-block="audio-drop-zone-{{form_id}}"/>
		<div class="valign upload_innr">
			<div class="sfy_up_mus_ico">
				<svg class="image" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="currentColor" d="M16,9H13V14.5A2.5,2.5 0 0,1 10.5,17A2.5,2.5 0 0,1 8,14.5A2.5,2.5 0 0,1 10.5,12C11.07,12 11.58,12.19 12,12.5V7H16M19,3H5A2,2 0 0,0 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V5A2,2 0 0,0 19,3Z" /></svg>
			</div>
			<div>
				<h4>{{LANG Select files to upload}}</h4>
				<p>{{LANG or drag & drop files here}}</p>
				<p class="drop_hint">{{LANG drop_your_files}}</p>
				<button class="btn btn-primary btn-mat btn-mat-raised btn-upload-music">{{LANG Upload}}</button>
			</div>
		</div>
		<div class="progress hidden">
		  <div class="progress-bar" role="progressbar" style="width: 0%;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">0%</div>
		</div>
	</div>
	<form action="" method="POST" id="upload-audio-{{form_id}}" class="v-hidden">
	</form>
	<div class="hidden" id="upload-form-{{form_id}}">
		<hr>
		<form action="" class="form-horizontal upload_form sfy_albm_upd_frm" method="POST" id="song-form-{{form_id}}">
			<div id="block-album-song-{{form_id}}"></div>
			<div class="user-output-alert-{{form_id}}"></div>
			<div class="alert alert-danger alert-empty" id="output-song-errors-{{form_id}}"></div>
			<div class="row">
				<div class="col-lg-4">
					<div class="upload-song-image" onclick="document.getElementById('thumbnail-{{form_id}}').click(); return false">
						<div class="valign upload-image-content" id="upload-image-content-{{form_id}}">
							<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path fill="currentColor" d="M21 15v3h3v2h-3v3h-2v-3h-3v-2h3v-3h2zm.008-12c.548 0 .992.445.992.993v9.349A5.99 5.99 0 0 0 20 13V5H4l.001 14 9.292-9.293a.999.999 0 0 1 1.32-.084l.093.085 3.546 3.55a6.003 6.003 0 0 0-3.91 7.743L2.992 21A.993.993 0 0 1 2 20.007V3.993A1 1 0 0 1 2.992 3h18.016zM8 7a2 2 0 1 1 0 4 2 2 0 0 1 0-4z" /></svg>
						</div>
					</div>
					<div class="progress hidden" id="img_upload_progress-{{form_id}}">
						<div id="img_upload_progress_bar-{{form_id}}" class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%"></div>
					</div>
				</div>
				<div class="col-lg-8">
					<div class="valign sfy_albm_block">
						<div class="sfy_mat_input">
							<input type="text" name="title" id="title-{{form_id}}" placeholder="{{LANG Title}}" required>
							<label for="title-{{form_id}}">{{LANG Title}}</label>
							<small class="form-text">{{LANG Your song title, 2 - 55 characters}}</small>
						</div>
						<div class="btn btn-mat btn-danger remove-album-song" id="remove-album-song-{{form_id}}" onclick="remove_song(this,'{{form_id}}')">
							<svg xmlns="http://www.w3.org/2000/svg" height="22" viewBox="0 0 24 24" width="22"><path fill="currentColor" d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V9c0-1.1-.9-2-2-2H8c-1.1 0-2 .9-2 2v10zM18 4h-2.5l-.71-.71c-.18-.18-.44-.29-.7-.29H9.91c-.26 0-.52.11-.7.29L8.5 4H6c-.55 0-1 .45-1 1s.45 1 1 1h12c.55 0 1-.45 1-1s-.45-1-1-1z"/></svg>
						</div>
					</div>
					<div class="sfy_mat_input">
						<textarea name="description" id="description" placeholder="{{LANG Description}}" rows="4"></textarea>
						<label for="description">{{LANG Description}}</label>
					</div>
					<div class="sfy_mat_input">
						<textarea name="lyrics" id="lyrics" placeholder="{{LANG Lyrics}}" rows="3"></textarea>
						<label for="lyrics">{{LANG Lyrics}}</label>
					</div>
					<div class="sfy_mat_input">
						<input type="text" name="tags" id="tags-{{form_id}}" placeholder="{{LANG Tags}}">
						<label for="tags-{{form_id}}">{{LANG Tags}}</label>
						<small class="form-text">{{LANG Add tags to describe more about your track}}</small>
					</div>
					<div class="sfy_mat_input">
						<select name="age_restriction" id="age_restriction" class="sfy_select_has_label">
							<option value="0" selected>{{LANG All ages can listen this song}}</option>
							<option value="1">{{LANG Only +18}}</option>
						</select>
						<label for="age_restriction">{{LANG Age Restriction}}</label>
					</div>
				</div>
			</div>
			<div class="sfy_forms_sbm_btn text-center">
				<button type="submit" class="btn btn-primary btn-mat btn-mat-raised btn-save-songs hidden" id="btn-song-submit-{{form_id}}" data-id="{{form_id}}" data-count=""><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="currentColor" d="M0.41,13.41L6,19L7.41,17.58L1.83,12M22.24,5.58L11.66,16.17L7.5,12L6.07,13.41L11.66,19L23.66,7M18,7L16.59,5.58L10.24,11.93L11.66,13.34L18,7Z" /></svg> {{LANG Save}}</button>
			</div>
			<input type="hidden" name="song-location" id="song-location-{{form_id}}" value="">
			<input type="hidden" name="song-thumbnail" id="song-thumbnail-{{form_id}}" value="">
			<input type="hidden" name="category_id" value="{{genre_id}}">
		</form>
		<form action="" id="thumbnail-form-{{form_id}}" method="POST">
			<input id="thumbnail-{{form_id}}" name="thumbnail" type="file" class="hidden" accept="image/*">
		</form>

		<script>
			$(function () {
				var audio_drop_block = $("[data-block='audio-drop-zone-{{form_id}}']");
				$('input[name="thumbnail"]').change(function(event) {
					let formid = '{{form_id}}';
					let formcount = $(this).attr('data-count');

					if (!validate_fileupload($('#thumbnail-{{form_id}}-'+formcount).val(), ["jpg","png","jpeg"])) {
						showResponseAlert('.user-output-alert-{{form_id}}','danger',"{{LANG Invalid file format, only jpg, jpeg, png are allowed}}",2000);
						return false;
					}
					let bar = $('#img_upload_progress-{{form_id}}-'+formcount);
					let percent = $('#img_upload_progress_bar-{{form_id}}-'+formcount);
					bar.removeClass('hidden');
					$.ajax({
						xhr: function() {
							let xhr = new window.XMLHttpRequest();
							xhr.upload.addEventListener("progress", function(evt){
								if (evt.lengthComputable) {
									let percentComplete = evt.loaded / evt.total;
									percentComplete = parseInt(percentComplete * 100);
									//status.html( percentComplete + "%");
									percent.width(percentComplete + '%');
									percent.html(percentComplete + '%');
									if (percentComplete === 100) {
										// bar.addClass('hidden');
										// percent.width('0%');
										// percent.html('0%');
									}
								}
							}, false);
							return xhr;
						},
						type: 'POST',
						url: '{{CONFIG ajax_url}}/upload-thumbnail?hash_id=' + $('.main_session').val(),
						data: new FormData($("#thumbnail-form-{{form_id}}-"+formcount)[0]),
						processData: false,
						contentType: false,
						success: function(data) {
							bar.addClass('hidden');
							percent.width('0%');
							percent.html('0%');
							if (data.status == 200) {
								$('#upload-image-content-{{form_id}}-'+formcount).html('<img src="' + data.full_thumbnail + '" style="width: 100%">');
								$('#song-thumbnail-{{form_id}}-'+formcount).val(data.thumbnail);
							} else if (data.status == 400) {
								showResponseAlert('.user-output-alert-{{form_id}}','danger',data.message,2000);
							} else {
								showResponseAlert('.user-output-alert-{{form_id}}','danger',"{{LANG Error found while uploading your image, please try again later.}}",2000);
							}
						}
					});

					event.preventDefault();
					event.stopImmediatePropagation();
					return false;

				});

				$('#upload-audio-{{form_id}}').submit(function(event) {
					var allowed = [<?php echo ($music->config->ffmpeg_system == "off") ? '"mp3"' : '"mp3","ogg","wav"'?>];
					
					for(let i = 0 ; i < $(".upload-audio-file-{{form_id}}").prop('files').length ; i++){
						var file_size = $(".upload-audio-file-{{form_id}}").prop('files')[i].size;
						if (file_size > <?php echo $music->config->user_max_upload?>) {
							showResponseAlert('.user-output-alert-{{form_id}}','danger',"{{LANG file_is_large}}",2000);
							return false;
						} else if (!validate_fileupload($('.upload-audio-file-{{form_id}}').val(), allowed)) {
							showResponseAlert('.user-output-alert-{{form_id}}','danger',"<?php echo ($music->config->ffmpeg_system == "off") ? lang("Invalid file format, only mp3 is allowed") : lang("Invalid file format, only mp3, ogg, wav, and mpeg is allowed")?>",2000);
							return false;
						} else {

							var filename = $(".upload-audio-file-{{form_id}}").prop('files')[i].name.split('\\').pop();
							$('#upload-bulk-song-form-{{form_id}} .upload').addClass('hidden');

							let clone = $('#upload-form-{{form_id}}').clone();
							clone.removeClass('hidden').addClass('no-flex');

							clone.find('#song-form-{{form_id}}').addClass('bulk-sound-upload');
							clone.find('#song-form-{{form_id}}').attr('data-id', i);
							clone.find('#song-form-{{form_id}}').attr('id', 'song-form-{{form_id}}-' + i);
							clone.find('#title-{{form_id}}').attr('value',filename).attr('id', 'title-{{form_id}}-' + i);

							clone.find('#output-song-errors-{{form_id}}').attr('value',filename).attr('id', 'output-song-errors-{{form_id}}-' + i);
							clone.find('#img_upload_progress-{{form_id}}').attr('id', 'img_upload_progress-{{form_id}}-' + i);
							clone.find('#img_upload_progress_bar-{{form_id}}').attr('id', 'img_upload_progress_bar-{{form_id}}-' + i);

							clone.find('#remove-album-song-{{form_id}}').attr('data-id', i);
							clone.find('#block-album-song-{{form_id}}').after('<div id="progress-'+i+'" class="progress hidden" style="width: 93%;margin: 0 auto;margin-bottom: 10px;"><div id="progress-bar-'+i+'" class="progress-bar" role="progressbar" style="width: 0%;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">0%</div></div>');

							clone.find('#remove-album-song-{{form_id}}').attr('id', 'remove-album-song-{{form_id}}-' + i);

							clone.find('#btn-song-submit-{{form_id}}').attr('data-count', i).attr('id', 'btn-song-submit-{{form_id}}-' + i);

							clone.find('#song-location-{{form_id}}').attr('id', 'song-location-{{form_id}}-' + i);
							clone.find('#song-thumbnail-{{form_id}}').attr('value',$('#song-thumbnail').attr('value')).attr('id', 'song-thumbnail-{{form_id}}-' + i);
							clone.find('#upload-image-content-{{form_id}}').html('<img src="'+$('#song-thumbnail').attr('value')+'" style="width: 100%;">').attr('id', 'upload-image-content-{{form_id}}-' + i);

							clone.find('.upload-song-image').attr('onclick',"document.getElementById('thumbnail-{{form_id}}-"+i+"').click(); return false");

							clone.find('#thumbnail-form-{{form_id}}').attr('id', 'thumbnail-form-{{form_id}}-' + i);
							clone.find('#thumbnail-{{form_id}}').attr('id', 'thumbnail-{{form_id}}-' + i).attr('data-formid','{{form_id}}').attr('data-count', i);

							clone.find('#tags-{{form_id}}').attr('id', 'tags-{{form_id}}-' + i);


							$('#upload-form').after(clone.html());


							$('#tags-{{form_id}}-' + i).tagit({
								allowSpaces: true
							});

							var formData = new FormData();
							var reader = new FileReader();
							reader.onload = function(e) {};
							reader.readAsDataURL($(".upload-audio-file-{{form_id}}").prop('files')[i]);
							formData.append("audio", $(".upload-audio-file-{{form_id}}").prop('files')[i],$(".upload-audio-file-{{form_id}}").prop('files')[0].value );

							var constructRequest = (function() {
								return function() {
									var local_id = i;
									$.ajax({
										beforeSend: function() {
											$('#progress-'+local_id).removeClass('hidden');
											$('#progress-bar-'+local_id).width('0%');
											$('#progress-bar-'+local_id).show();
										},
										xhr: function() {
											var xhr = new window.XMLHttpRequest();
											xhr.upload.addEventListener("progress", function(evt){
												if (evt.lengthComputable) {
													var percentComplete = evt.loaded / evt.total;
													percentComplete = parseInt(percentComplete * 100);
													$('#progress-bar-'+local_id).width(percentComplete + '%');
													if (percentComplete === 100) {

													}else{
														$('#progress-'+local_id).removeClass('hidden');
													}
												}
											}, false);
											return xhr;
										},
										url: '{{CONFIG ajax_url}}/upload-song?hash_id=' + $('.main_session').val(),
										type: "POST",
										async: true,
										data: formData,
										cache: false,
										contentType: false,
										processData: false,
										timeout: 60000,
										dataType: false,
										success: function(result) {
											if( result.status == 200 ){

												$('#song-form-{{form_id}}-'+local_id).find('input[name="song-location"]').attr('value',result.file_path);
												$('#song-location-{{form_id}}-' + local_id).val(result.file_path);
												$('#progress-'+local_id).css({'display':'none'});
												$('#progress-'+local_id).addClass('hidden');
												$('#progress-bar-'+local_id).width('0%');

												$('#song-form-{{form_id}}-'+local_id).ajaxForm({
													url: "{{CONFIG ajax_url}}/submit-song?hash_id=" + getHashID(),
													beforeSubmit:  function () {
														$('#output-song-errors-{{form_id}}-'+local_id).removeClass("alert-success").addClass('alert-danger');
														$('#output-song-errors-{{form_id}}-'+local_id).empty();
														$("#btn-song-submit-{{form_id}}-"+local_id).text("{{LANG Please wait..}}");
														$("#btn-song-submit-{{form_id}}-"+local_id).attr("disabled", "true");
													},
													success: function (data) {
														if (data.status == 200) {
															$('html,body').animate({
																scrollTop: $("#song-form-{{form_id}}-"+local_id).offset().top
															}, 'slow');
															$('#output-song-errors-{{form_id}}-'+local_id).removeClass("alert-danger").addClass('alert-success');
														<?php if ($music->config->ffmpeg_system == "on") { ?>
																$('#output-song-errors-{{form_id}}-'+local_id).html("{{LANG Please wait, your track is being coverted to mp3 audio file. This might take a few minutes.}}");
																$.post('{{CONFIG ajax_url}}/convert-track?reset=false', {id: data.audio_id, file: data.song_location}, function(dataSecond, textStatus, xhr) {
																	if (dataSecond.status == 200) {
																		$('#song-form-{{form_id}}-'+local_id).html('<div class="hidden submitted-song" data-id="' + data.audio_id + '"></div><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="currentColor" d="M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M17,18H7V16H17V18M10.3,14L7,10.7L8.4,9.3L10.3,11.2L15.6,5.9L17,7.3L10.3,14Z"></path></svg> ' + $('#title-{{form_id}}-'+local_id).val() + ' {{LANG successfully uploaded}}');
																		$('#song-form-{{form_id}}-'+local_id).addClass('no-padding-form submitted');
																		publish();
																		$('#song-form-{{form_id}}-'+local_id+' .btn-save-songs').addClass('submitted');
																	}
																});
															<?php } else { ?>
																$('#song-form-{{form_id}}-'+local_id).html('<div class="hidden submitted-song" data-id="' + data.audio_id + '"></div><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="currentColor" d="M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M17,18H7V16H17V18M10.3,14L7,10.7L8.4,9.3L10.3,11.2L15.6,5.9L17,7.3L10.3,14Z"></path></svg> ' + $('#title-{{form_id}}-'+local_id).val() + ' {{LANG successfully uploaded}}');
																$('#song-form-{{form_id}}-'+local_id).addClass('no-padding-form submitted');
																publish();
																$('#song-form-{{form_id}}-'+local_id+' .btn-save-songs').addClass('submitted');
															<?php } ?>
														} else if (data.status == 400) {
															$("#btn-song-submit-{{form_id}}-"+local_id).removeAttr("disabled");
															$("#btn-song-submit-{{form_id}}-"+local_id).text("{{LANG Publish}}");
															$('#output-song-errors-{{form_id}}-'+local_id).html(data.message);
															$('#btn-publish-song').removeAttr('disabled');
															$('#btn-publish-song').text("{{LANG Publish}}");
															$('html,body').animate({
																scrollTop: $("#song-form-{{form_id}}-"+local_id).offset().top
															}, 'slow');
														}
													}
												});
											}
										}
									});
								}
							})();

							constructRequest();
						}
					}
					event.preventDefault();
				});

				$('.upload-audio-file-{{form_id}}').on('change', function() {
					$('#upload-audio-{{form_id}}').submit();
				});

			});
		</script>
	</div>
</div>